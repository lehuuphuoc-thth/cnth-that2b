<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√¥ng ngh·ªá 5 - B√†i 2: Nh√† S√°ng Ch·∫ø T√≠ Hon</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* CSS cho tr√≤ ch∆°i */
        :root {
            --primary-color: #03A9F4; /* M√†u Xanh D∆∞∆°ng - ch·ªß ƒë·∫°o C√¥ng ngh·ªá */
            --secondary-color: #81D4FA; /* M√†u Xanh nh·∫°t - l√†m n·ªïi b·∫≠t */
            --background-color: #E1F5FE; /* N·ªÅn Xanh nh·∫°t */
            --card-color: #FFFFFF;
            --correct-color: #4CAF50; /* Xanh l√° */
            --incorrect-color: #F44336; /* ƒê·ªè (V·∫´n gi·ªØ ƒë·ªãnh nghƒ©a nh∆∞ng kh√¥ng d√πng trong logic ch·ªçn ƒë√°p √°n) */
            --text-color: #01579B; /* Xanh ƒë·∫≠m */
            --font-family: 'Arial', sans-serif;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(3, 169, 244, 0.5); }
            50% { box-shadow: 0 0 20px rgba(3, 169, 244, 0.8); }
            100% { box-shadow: 0 0 10px rgba(3, 169, 244, 0.5); }
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #4FC3F7 0%, #E1F5FE 100%);
        }

        .game-container {
            background-color: var(--card-color);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 800px;
            width: 100%;
            text-align: center;
            transition: all 0.5s ease-in-out;
            position: relative;
            border: 4px solid var(--primary-color);
            animation: fadeIn 0.8s ease-out;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* --- Ph·∫ßn 1: ƒêi·ªÅn th√¥ng tin --- */
        #info-section input {
            width: calc(100% - 20px);
            padding: 12px;
            margin: 10px 0;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-size: 1.1em;
            box-sizing: border-box;
        }

        .btn {
            background-color: var(--primary-color);
            color: var(--card-color);
            padding: 15px 30px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
        }

        .btn:hover {
            background-color: #01579B;
            transform: translateY(-3px);
            animation: none;
        }

        /* --- Ph·∫ßn 2: Tr√≤ ch∆°i --- */
        #game-section {
            text-align: left;
            animation: fadeIn 0.8s ease-out;
        }

        #challenge-counter {
            font-size: 1.4em;
            color: var(--text-color);
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #B3E5FC;
            padding-bottom: 5px;
        }

        #challenge-text {
            background-color: #B3E5FC;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-left: 5px solid var(--primary-color);
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            background-color: #f0f0f0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            text-align: left;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .option-btn:hover:not(.correct):not(.incorrect):not([disabled]) {
            background-color: #E0F7FA;
            border-color: var(--secondary-color);
        }
        
        /* CSS Ph√¢n bi·ªát ƒê√∫ng/Sai cho n√∫t tr·∫Øc nghi·ªám */
        /* QUAN TR·ªåNG: Ch·ªâ s·ª≠ d·ª•ng m√†u Correct (Xanh l√°) cho m·ªçi l·ª±a ch·ªçn */
        .option-btn.correct { 
            background-color: var(--correct-color); /* Xanh l√° */
            color: white;
            border-color: #388E3C;
            font-weight: bold;
        }
        
        /* CSS n√†y s·∫Ω kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng cho tr·∫Øc nghi·ªám */
        .option-btn.incorrect { 
            background-color: var(--incorrect-color); 
            color: white;
            border-color: #D32F2F;
            font-weight: bold;
        }
        
        /* ƒê·∫£m b·∫£o n√∫t ƒë√£ ch·ªçn kh√¥ng b·ªã m·∫•t m√†u khi √°p d·ª•ng m√†u k·∫øt qu·∫£ */
        .option-btn.selected:not(.correct):not(.incorrect) {
            background-color: #4FC3F7; 
            border-color: var(--primary-color);
            font-weight: bold;
            color: var(--text-color);
        }
        
        /* D·∫°ng K√©o th·∫£ (Drag and Drop) */
        .drag-drop-area {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            min-height: 250px;
            text-align: center;
        }
        
        .drop-target {
            flex: 1;
            background-color: #B3E5FC; /* Xanh nh·∫°t */
            padding: 15px;
            border-radius: 15px;
            border: 3px dashed var(--primary-color);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }
        
        .drop-target.drag-over {
            border-color: var(--correct-color);
            background-color: #E0F7FA;
        }
        
        .drag-item {
            background-color: var(--primary-color); /* Xanh D∆∞∆°ng */
            color: var(--card-color);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: grab;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
            touch-action: none; /* Quan tr·ªçng cho mobile */
        }

        /* T√πy ch·ªânh cho ph·∫ßn t·ª≠ ƒëang k√©o tr√™n Mobile */
        .drag-item.dragging { 
            opacity: 0.8; 
            transform: scale(1.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* CSS Ph√¢n bi·ªát ƒê√∫ng/Sai cho k√©o th·∫£ */
        /* QUAN TR·ªåNG: S·ª≠a ƒë·ªÉ ch·ªâ d√πng m√†u Xanh L√° cho m·ªçi m·ª•c sau khi k√©o th·∫£ */
        .drag-item.correct-answer {
            background-color: var(--correct-color); /* Xanh l√° */
            color: white;
            border: 2px solid #388E3C;
        }

        /* L∆ØU √ù: Class n√†y KH√îNG C√íN ƒê∆Ø·ª¢C G√ÅN trong JS n·ªØa */
        .drag-item.incorrect-answer {
            /* background-color: var(--incorrect-color); */ 
            /* color: white; */
            /* border: 2px solid #D32F2F; */
            /* B·ªã ghi ƒë√® b·ªüi correct-answer, ho·∫∑c t·ªët nh·∫•t l√† kh√¥ng g√°n */
        }
        
        .drag-source {
            background-color: #F1F8E9;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            border: 1px solid #B3E5FC;
        }
        
        /* T√πy ch·ªânh cho Drag-Drop k·∫øt qu·∫£ */
        .drop-target h3 {
             color: var(--text-color);
        }


        /* --- Ph·∫ßn 3: K·∫øt qu·∫£ --- */
        #result-section {
            padding: 30px;
            background: linear-gradient(135deg, #81D4FA 0%, #03A9F4 100%);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            margin-top: 20px;
            color: #424242;
        }

        #result-info p {
            font-size: 1.2em;
            margin: 10px 0;
            text-align: left;
            color: #424242;
        }

        #result-info span {
            font-weight: bold;
            color: var(--text-color); 
            float: right;
        }

        #review-text {
            font-size: 1.5em;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            color: white;
            animation: pulse 1s infinite alternate;
        }
        
        .review-excellent { background-color: var(--correct-color); }
        .review-good { background-color: #FFB300; }
        .review-need-review { background-color: var(--incorrect-color); }

        #award-image {
            width: 120px;
            height: 120px;
            margin: 20px auto;
            background-color: var(--primary-color);
            border: 6px solid var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
            box-shadow: 0 0 15px rgba(3, 169, 244, 0.8);
        }
        
        .hidden {
            display: none;
        }
        
        .character-status span {
            color: var(--primary-color);
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="game-container" id="game-area">
        <h1>‚öôÔ∏è NH√Ä S√ÅNG CH·∫æ T√ç HON üí°</h1>

        <div id="info-section">
            <p>Ch√†o em, h√£y nh·∫≠p th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu th·ª≠ th√°ch t√¨m hi·ªÉu v·ªÅ Nh√† s√°ng ch·∫ø!</p>
            <input type="text" id="player-name" placeholder="H·ªç v√† t√™n c·ªßa em" required>
            <input type="text" id="player-class" placeholder="L·ªõp (V√≠ d·ª•: 5A1)" required>
            <button class="btn" onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
        </div>

        <div id="game-section" class="hidden">
            <div id="challenge-counter">
                <span>Th·ª≠ th√°ch: <span id="current-challenge-number">1</span> / 10</span>
                <span id="player-status">Ch√†o <span id="display-name"></span>!</span>
            </div>
            
            <div id="challenge-text"></div>
            
            <div id="question-area">
                </div>
            
            <div class="character-status">
                Tr·∫°ng th√°i: ƒê√£ ho√†n th√†nh ƒë√∫ng <span id="correct-count-display">0</span> th·ª≠ th√°ch
            </div>

            <button class="btn hidden" id="next-button" onclick="nextChallenge()">Ti·∫øp t·ª•c üöÄ</button>
        </div>

        <div id="result-section" class="hidden">
            <h2>‚ú® CH√öC M·ª™NG EM ‚ú®</h2>
            <div id="result-info">
                <p>H·ªç t√™n: <span id="res-name"></span></p>
                <p>L·ªõp: <span id="res-class"></span></p>
                <p>S·ªë l·∫ßn ch∆°i: <span id="res-play-count"></span></p>
                <p>T·ªïng th·ª≠ th√°ch: <span id="res-total-challenges"></span></p>
                <p>S·ªë th·ª≠ th√°ch ƒë√∫ng: <span id="res-correct-challenges"></span></p>
                <p>% ho√†n th√†nh ƒë√∫ng: <span id="res-percentage"></span></p>
                <p>Th·ªùi gian ho√†n th√†nh: <span id="res-time"></span></p>
            </div>
            <div id="review-text"></div>
            <div id="award-image">‚öôÔ∏è</div>
            <button class="btn" onclick="restartGame()">Ch∆°i l·∫°i</button>
            <button class="btn" onclick="shareResult()">Chia s·∫ª k·∫øt qu·∫£ üì∏</button>
        </div>
        
        <audio id="sfx-correct" src="https://www.soundjay.com/buttons/button-2.mp3" preload="auto"></audio>
        <audio id="sfx-incorrect" src="https://www.soundjay.com/buttons/button-3.mp3" preload="auto"></audio> 
        <audio id="sfx-complete" src="https://www.soundjay.com/misc/fanfare.mp3" preload="auto"></audio>

    </div>

    <script>
        // JavaScript cho tr√≤ ch∆°i
        const gameData = [
            {
                id: 1,
                type: 'multiple-choice',
                question: "Vai tr√≤ ch√≠nh c·ªßa s√°ng ch·∫ø trong ƒë·ªùi s·ªëng l√† g√¨?",
                options: [
                    { text: "L√†m cho s·∫£n ph·∫©m tr·ªü n√™n ƒë·∫πp h∆°n.", isCorrect: false },
                    { text: "T·∫°o ra s·∫£n ph·∫©m m·ªõi ho·∫∑c c·∫£i ti·∫øn ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ, ƒë√°p ·ª©ng nhu c·∫ßu c·ªßa con ng∆∞·ªùi.", isCorrect: true },
                    { text: "Ch·ªâ ƒë·ªÉ l√†m cho nh√† s√°ng ch·∫ø tr·ªü n√™n gi√†u c√≥.", isCorrect: false },
                    { text: "Ghi l·∫°i nh·ªØng ƒëi·ªÅu ƒë√£ x·∫£y ra trong qu√° kh·ª©.", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "S√°ng ch·∫ø ra ƒë·ªùi ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ v√† ƒë√°p ·ª©ng nhu c·∫ßu c·ªßa con ng∆∞·ªùi, ƒë√¢y l√† vai tr√≤ quan tr·ªçng nh·∫•t."
            },
            {
                id: 2,
                type: 'multiple-choice',
                question: "ƒê·ª©c t√≠nh n√†o gi√∫p nh√† s√°ng ch·∫ø v∆∞·ª£t qua h√†ng ng√†n l·∫ßn th·ª≠ nghi·ªám th·∫•t b·∫°i m√† kh√¥ng b·ªè cu·ªôc?",
                options: [
                    { text: "D≈©ng c·∫£m", isCorrect: false },
                    { text: "Th√¥ng minh", isCorrect: false },
                    { text: "Ki√™n tr√¨ v√† kh√¥ng n·∫£n ch√≠.", isCorrect: true },
                    { text: "Nhanh nh·∫πn", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "Ki√™n tr√¨ l√† ph·∫©m ch·∫•t c·ªët l√µi gi√∫p nh√† s√°ng ch·∫ø l·∫∑p l·∫°i v√† c·∫£i ti·∫øn cho ƒë·∫øn khi th√†nh c√¥ng."
            },
            {
                id: 3,
                type: 'multiple-choice',
                question: "Ai l√† ng∆∞·ªùi s√°ng ch·∫ø ra **b√≥ng ƒë√®n ƒëi·ªán s·ª£i ƒë·ªët** v√† n·ªïi ti·∫øng v·ªõi c√¢u n√≥i v·ªÅ s·ª± th·∫•t b·∫°i l√† c·∫ßn thi·∫øt cho th√†nh c√¥ng?",
                options: [
                    { text: "Alexander Graham Bell", isCorrect: false },
                    { text: "Thomas Edison", isCorrect: true },
                    { text: "Anh em nh√† Wright", isCorrect: false },
                    { text: "Nikola Tesla", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "Thomas Edison l√† nh√† s√°ng ch·∫ø vƒ© ƒë·∫°i ƒë√£ ph√°t minh ra b√≥ng ƒë√®n ƒëi·ªán v√† nhi·ªÅu thi·∫øt b·ªã quan tr·ªçng kh√°c."
            },
            {
                id: 4,
                type: 'true-false',
                question: "M·ªôt s√°ng ch·∫ø ch·ªâ ƒë∆∞·ª£c coi l√† th√†nh c√¥ng khi n√≥ l√† m·ªôt ph√°t minh ph·ª©c t·∫°p, ƒë·∫Øt ti·ªÅn v√† ph·∫£i ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i tr√™n to√†n th·∫ø gi·ªõi.",
                answer: false, 
                answered: false,
                isCorrect: null,
                explanation: "Sai. M·ªôt s√°ng ch·∫ø th√†nh c√¥ng c√≥ th·ªÉ l√† m·ªôt c·∫£i ti·∫øn nh·ªè, ƒë∆°n gi·∫£n nh∆∞ng h·ªØu √≠ch, gi·∫£i quy·∫øt ƒë∆∞·ª£c v·∫•n ƒë·ªÅ th·ª±c t·∫ø."
            },
            {
                id: 5,
                type: 'multiple-choice',
                question: "S√°ng ch·∫ø ti√™u bi·ªÉu n√†o ƒë√£ t·∫°o ra b∆∞·ªõc ngo·∫∑t l·ªõn, m·ªü ra K·ª∑ nguy√™n C√¥ng nghi·ªáp h√≥a, gi√∫p di chuy·ªÉn m√°y m√≥c v√† t√†u h·ªèa?",
                options: [
                    { text: "B√≥ng ƒë√®n ƒëi·ªán", isCorrect: false },
                    { text: "ƒê·ªông c∆° h∆°i n∆∞·ªõc", isCorrect: true },
                    { text: "M√°y t√≠nh c√° nh√¢n", isCorrect: false },
                    { text: "ƒêi·ªán tho·∫°i di ƒë·ªông", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "ƒê·ªông c∆° h∆°i n∆∞·ªõc l√† s√°ng ch·∫ø then ch·ªët c·ªßa cu·ªôc C√°ch m·∫°ng C√¥ng nghi·ªáp l·∫ßn th·ª© nh·∫•t, thay ƒë·ªïi ho√†n to√†n c√°ch th·ª©c s·∫£n xu·∫•t v√† di chuy·ªÉn."
            },
            {
                id: 6,
                type: 'multiple-choice',
                question: "Ph·∫©m ch·∫•t n√†o th√∫c ƒë·∫©y nh√† s√°ng ch·∫ø lu√¥n t√¨m ki·∫øm, quan s√°t v√† ƒë·∫∑t c√¢u h·ªèi 'T·∫°i sao?', 'L√†m th·∫ø n√†o?' v·ªÅ m·ªçi th·ª© xung quanh?",
                options: [
                    { text: "Th·∫≠n tr·ªçng", isCorrect: false },
                    { text: "Ti·∫øt ki·ªám", isCorrect: false },
                    { text: "T√≤ m√≤ v√† √≥c quan s√°t", isCorrect: true },
                    { text: "C·∫©n th·∫≠n", isCorrect: false }
                ],
                answered: false,
                isCorrect: null
            },
            {
                id: 7,
                type: 'multiple-choice',
                question: "**Anh em nh√† Wright** n·ªïi ti·∫øng v√¨ s√°ng ch·∫ø ra s·∫£n ph·∫©m c√¥ng ngh·ªá ti√™u bi·ªÉu n√†o trong l·ªãch s·ª≠?",
                options: [
                    { text: "T√†u ng·∫ßm", isCorrect: false },
                    { text: "Xe √¥ t√¥ t·ª± l√°i", isCorrect: false },
                    { text: "M√°y bay", isCorrect: true },
                    { text: "T√†u v≈© tr·ª•", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "Anh em nh√† Wright ƒë√£ ph√°t minh ra m√°y bay c√≥ ƒë·ªông c∆° th√†nh c√¥ng ƒë·∫ßu ti√™n, m·ªü ra k·ª∑ nguy√™n h√†ng kh√¥ng."
            },
            {
                id: 8,
                type: 'multiple-choice',
                question: "Vi·ªác t·∫°o ra m·ªôt s√°ng ch·∫ø m·ªõi c√≥ vai tr√≤ g√¨ ƒë·ªëi v·ªõi **s·ª± ph√°t tri·ªÉn c·ªßa c√¥ng ngh·ªá**?",
                options: [
                    { text: "L√†m cho c√¥ng ngh·ªá hi·ªán t·∫°i b·ªã l·ªói th·ªùi ngay l·∫≠p t·ª©c.", isCorrect: false },
                    { text: "M·ªü ra h∆∞·ªõng ƒëi m·ªõi, t·∫°o n·ªÅn t·∫£ng cho c√°c c√¥ng ngh·ªá kh√°c ra ƒë·ªùi v√† ph√°t tri·ªÉn.", isCorrect: true },
                    { text: "L√†m cho ƒë·ªùi s·ªëng tr·ªü n√™n ph·ª©c t·∫°p h∆°n.", isCorrect: false },
                    { text: "Kh√¥ng c√≥ vai tr√≤ g√¨ ƒë√°ng k·ªÉ, ch·ªâ l√† s·ª± thay th·∫ø.", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "M·ªói s√°ng ch·∫ø l√† m·ªôt b∆∞·ªõc ƒë·ªám, t·∫°o ƒëi·ªÅu ki·ªán cho c√°c ph√°t minh v√† c√¥ng ngh·ªá k·∫ø ti·∫øp ph√°t tri·ªÉn."
            },
            {
                id: 9,
                type: 'multiple-choice',
                question: "S√°ng ch·∫ø **B√∫t bi** ƒë√£ thay th·∫ø c√¥ng c·ª• vi·∫øt truy·ªÅn th·ªëng n√†o, gi√∫p cho vi·ªác ghi ch√©p tr·ªü n√™n nhanh ch√≥ng, ti·ªán l·ª£i v√† s·∫°ch s·∫Ω h∆°n?",
                options: [
                    { text: "B√∫t ch√¨", isCorrect: false },
                    { text: "B√†n ph√≠m m√°y t√≠nh", isCorrect: false },
                    { text: "B√∫t m√°y v√† b√∫t l√¥ng ng·ªóng", isCorrect: true },
                    { text: "M√°y in", isCorrect: false }
                ],
                answered: false,
                isCorrect: null,
                explanation: "B√∫t bi (Ballpoint pen) do L√°szl√≥ B√≠r√≥ s√°ng ch·∫ø, ƒë√£ thay th·∫ø b√∫t m√°y v√† c√°c lo·∫°i b√∫t m·ª±c c·ªï ƒëi·ªÉn, ti·ªán d·ª•ng h∆°n r·∫•t nhi·ªÅu."
            },
            {
                id: 10,
                type: 'drag-drop',
                question: "H√£y k√©o th·∫£ c√°c ph·∫©m ch·∫•t sau v√†o nh√≥m **ƒê·ª©c t√≠nh C·∫¶N C√ì** ho·∫∑c **ƒê·ª©c t√≠nh KH√îNG PH√ô H·ª¢P** v·ªõi m·ªôt nh√† s√°ng ch·∫ø.",
                items: [
                    { text: "S√°ng t·∫°o v√† Linh ho·∫°t", category: "ƒê·ª©c t√≠nh C·∫¶N C√ì" },
                    { text: "Th√≠ch sao ch√©p √Ω t∆∞·ªüng c·ªßa ng∆∞·ªùi kh√°c", category: "ƒê·ª©c t√≠nh KH√îNG PH√ô H·ª¢P" },
                    { text: "T√≤ m√≤ v√† Ham h·ªçc h·ªèi", category: "ƒê·ª©c t√≠nh C·∫¶N C√ì" },
                    { text: "Hay ch√°n n·∫£n, d·ªÖ b·ªè cu·ªôc", category: "ƒê·ª©c t√≠nh KH√îNG PH√ô H·ª¢P" }
                ],
                categories: ["ƒê·ª©c t√≠nh C·∫¶N C√ì", "ƒê·ª©c t√≠nh KH√îNG PH√ô H·ª¢P"],
                answered: false,
                isCorrect: null
            }
        ];

        let questions = []; 
        let currentChallengeIndex = 0;
        let correctChallenges = 0;
        let startTime;
        let playerInfo = {};
        let currentDraggedItem = null; 

        // D√πng local storage ri√™ng cho B√†i 2 C√¥ng ngh·ªá 5
        let playerRecords = JSON.parse(localStorage.getItem('gameRecords_CN5_B2')) || {};

        // === H√†m ti·ªán √≠ch ===

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function playSound(type) {
            // D√ôNG √ÇM THANH CORRECT CHO C·∫¢ HAI TR∆Ø·ªúNG H·ª¢P ƒê·ªÇ KHUY·∫æN KH√çCH
            const audio = document.getElementById('sfx-correct'); 
            if (audio) {
                audio.currentTime = 0;
                audio.play();
            }
        }
        
        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes} ph√∫t ${seconds} gi√¢y`;
        }
        
        function savePlayerRecord() {
            const playerId = playerInfo.name + playerInfo.class;
            if (!playerRecords[playerId]) {
                playerRecords[playerId] = {
                    name: playerInfo.name,
                    class: playerInfo.class,
                    playCount: 0
                };
            }
            playerRecords[playerId].playCount += 1;
            playerInfo.playCount = playerRecords[playerId].playCount;
            localStorage.setItem('gameRecords_CN5_B2', JSON.stringify(playerRecords));
        }

        // === Ph·∫ßn 1 & B·∫Øt ƒë·∫ßu tr√≤ ch∆°i ===

        function loadExistingPlayer(name, playerClass) {
             const playerId = name + playerClass;
             if (playerRecords[playerId]) {
                 playerInfo.playCount = playerRecords[playerId].playCount;
                 return true;
             }
             return false;
        }
        
        function startGame(isReplay = false) {
            if (!isReplay) {
                const name = document.getElementById('player-name').value.trim();
                const playerClass = document.getElementById('player-class').value.trim();

                if (!name || !playerClass) {
                    alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß H·ªç v√† t√™n, L·ªõp.');
                    return;
                }
                
                playerInfo = { name, class: playerClass };
                loadExistingPlayer(name, playerClass);
            }
            
            savePlayerRecord(); 
            
            document.getElementById('info-section').classList.add('hidden');
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('game-section').classList.remove('hidden');

            document.getElementById('display-name').textContent = playerInfo.name;
            
            // --- RESET TO√ÄN B·ªò TR·∫†NG TH√ÅI TR√í CH∆†I ---
            questions = gameData.map(q => ({ 
                ...q, 
                answered: false, 
                isCorrect: null,
                domElements: null
            })); 
            questions = shuffleArray(questions);
            
            currentChallengeIndex = 0;
            correctChallenges = 0;
            startTime = Date.now();
            
            questions.forEach(q => {
                 if (q.type === 'drag-drop') {
                     q.shuffledItems = shuffleArray([...q.items]);
                 }
            });

            loadChallenge();
        }
        
        function restartGame() {
            // L·∫•y l·∫°i th√¥ng tin c≈© v√† tƒÉng s·ªë l·∫ßn ch∆°i, b·ªè qua Ph·∫ßn 1
            startGame(true);
        }

        // === Ph·∫ßn 2: N·ªôi dung tr√≤ ch∆°i ===

        function loadChallenge() {
            if (currentChallengeIndex >= questions.length) {
                finishGame();
                return;
            }

            const challenge = questions[currentChallengeIndex];
            
            document.getElementById('next-button').classList.add('hidden');
            document.getElementById('current-challenge-number').textContent = currentChallengeIndex + 1;
            document.getElementById('correct-count-display').textContent = correctChallenges;
            document.getElementById('challenge-text').textContent = challenge.question;
            
            const questionArea = document.getElementById('question-area');
            questionArea.innerHTML = '';
            
            // Load giao di·ªán theo lo·∫°i c√¢u h·ªèi
            switch (challenge.type) {
                case 'multiple-choice':
                case 'true-false':
                    loadMultipleChoice(challenge, questionArea);
                    break;
                case 'drag-drop':
                    loadDragDrop(challenge, questionArea);
                    break;
            }
        }

        // --- D·∫°ng Tr·∫Øc nghi·ªám (Multiple Choice / True False) ---
        
        function loadMultipleChoice(challenge, container) {
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'options-container';

            let optionsToRender = [];
            if (challenge.type === 'multiple-choice') {
                optionsToRender = challenge.options.map((opt, index) => ({
                    text: `${String.fromCharCode(65 + index)}. ${opt.text}`,
                    isCorrect: opt.isCorrect,
                    originalIndex: index
                }));
            } else if (challenge.type === 'true-false') {
                optionsToRender = [
                    { text: 'A. ƒê√∫ng', isCorrect: challenge.answer === true, originalIndex: 0 },
                    { text: 'B. Sai', isCorrect: challenge.answer === false, originalIndex: 1 }
                ];
            }
            
            const shuffledOptions = shuffleArray(optionsToRender);
            
            shuffledOptions.forEach((option) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.text;
                btn.onclick = () => selectOption(btn, option.isCorrect, optionsToRender); 
                optionsContainer.appendChild(btn);
            });
            container.appendChild(optionsContainer);
        }

        function selectOption(selectedBtn, isCorrect, optionsToRender) {
            if (questions[currentChallengeIndex].answered) return;

            const options = selectedBtn.parentNode.querySelectorAll('.option-btn');
            const challenge = questions[currentChallengeIndex];

            options.forEach(btn => {
                btn.disabled = true; // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c n√∫t
                
                if (btn === selectedBtn) {
                     // 1. CH·ªà T√î M√ÄU XANH L√Å (M√†u Correct) D√ô ƒê√öNG HAY SAI
                     btn.classList.add('correct'); 
                     btn.classList.remove('selected', 'incorrect');
                } else {
                     // 2. C√°c n√∫t c√≤n l·∫°i ch·ªâ b·ªã l√†m m·ªù ƒëi (KH√îNG hi·ªÉn th·ªã ƒë√°p √°n ƒë√∫ng)
                     btn.style.opacity = '0.6';
                     btn.classList.remove('selected');
                }
            }); 
            
            challenge.answered = true;
            challenge.isCorrect = isCorrect; // V·∫´n l∆∞u k·∫øt qu·∫£ th·ª±c t·∫ø ƒë·ªÉ t√≠nh ƒëi·ªÉm cu·ªëi c√πng

            // 3. CH·ªà PH√ÅT √ÇM THANH "ƒê√öNG" D√ô K·∫æT QU·∫¢ L√Ä G√å
            playSound('correct');
            
            // 4. C·∫¨P NH·∫¨T ƒêI·ªÇM TH·ª∞C T·∫æ (·∫®N V·ªöI NG∆Ø·ªúI CH∆†I)
            if (isCorrect) {
                 correctChallenges++;
            }

            document.getElementById('next-button').classList.remove('hidden');
        }
        
        // === H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN C·∫¢M ·ª®NG (TOUCH EVENTS) CHO DRAG-DROP ===
        
        function handleTouchMove(e) {
            if (!currentDraggedItem || questions[currentChallengeIndex].answered) return;
            e.preventDefault();

            const touch = e.touches[0];
            
            // Di chuy·ªÉn item theo ng√≥n tay
            currentDraggedItem.style.left = (touch.clientX - currentDraggedItem.offsetX) + 'px';
            currentDraggedItem.style.top = (touch.clientY - currentDraggedItem.offsetY) + 'px';

            // Highlight drop target khi ch·∫°m v√†o
            document.querySelectorAll('.drop-target').forEach(target => {
                const rect = target.getBoundingClientRect();
                if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                    touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                    target.classList.add('drag-over');
                } else {
                    target.classList.remove('drag-over');
                }
            });
        }
        
        // --- D·∫°ng K√©o th·∫£ (Drag and Drop) ---
        
        function loadDragDrop(challenge, container) {
            
            // H√†m x·ª≠ l√Ω Touch Start (ƒê∆∞·ª£c ƒë·ªãnh nghƒ©a l·∫°i trong loadDragDrop ƒë·ªÉ g√°n challenge)
            const touchStartHandler = function(e) {
                if (challenge.answered) return;
                e.preventDefault(); 
                
                const item = this; // 'this' l√† dragItem
                currentDraggedItem = item;
                item.classList.add('dragging');

                // ƒê·∫∑t item ·ªü v·ªã tr√≠ tuy·ªát ƒë·ªëi ƒë·ªÉ di chuy·ªÉn
                item.style.position = 'absolute';
                item.style.zIndex = '1000';
                
                // Ghi l·∫°i offset ƒë·ªÉ gi·ªØ nguy√™n v·ªã tr√≠ t∆∞∆°ng ƒë·ªëi v·ªõi ƒëi·ªÉm ch·∫°m
                const touch = e.touches[0];
                const rect = item.getBoundingClientRect();
                item.offsetX = touch.clientX - rect.left;
                item.offsetY = touch.clientY - rect.top;
                
                // Di chuy·ªÉn item ƒë·∫øn v·ªã tr√≠ ch·∫°m
                item.style.left = (touch.clientX - item.offsetX) + 'px';
                item.style.top = (touch.clientY - item.offsetY) + 'px';
            };
            
            // H√†m x·ª≠ l√Ω Touch End (ƒê∆∞·ª£c ƒë·ªãnh nghƒ©a l·∫°i trong loadDragDrop ƒë·ªÉ g√°n challenge)
            const touchEndHandler = function(e) {
                if (challenge.answered) return;
                e.preventDefault();
                
                const item = this; // 'this' l√† dragItem
                const touch = e.changedTouches[0];
                let dropped = false;

                document.querySelectorAll('.drop-target').forEach(target => {
                    target.classList.remove('drag-over');
                    const rect = target.getBoundingClientRect();
                    
                    // Ki·ªÉm tra xem ng√≥n tay c√≥ k·∫øt th√∫c trong khu v·ª±c th·∫£ kh√¥ng
                    if (touch.clientX >= rect.left && touch.clientX <= rect.right &&
                        touch.clientY >= rect.top && touch.clientY <= rect.bottom) {
                        
                        // X·ª≠ l√Ω vi·ªác th·∫£
                        target.appendChild(item);
                        item.style.position = 'static'; 
                        item.style.zIndex = 'auto';
                        item.style.left = 'auto';
                        item.style.top = 'auto';
                        dropped = true;
                    }
                });
                
                if (!dropped) {
                    // N·∫øu kh√¥ng th·∫£ v√†o khu v·ª±c n√†o, ƒë∆∞a item tr·ªü l·∫°i khu v·ª±c ngu·ªìn (drag-source)
                    const dragSource = document.querySelector('.drag-source');
                    dragSource.appendChild(item);
                    item.style.position = 'static'; 
                    item.style.zIndex = 'auto';
                    item.style.left = 'auto';
                    item.style.top = 'auto';
                }

                item.classList.remove('dragging');
                currentDraggedItem = null;
                
                // Ki·ªÉm tra v√† k·∫øt th√∫c c√¢u h·ªèi k√©o th·∫£
                checkDragDropComplete(challenge);
            };
            
            // --- B·∫Øt ƒë·∫ßu Load Giao di·ªán ---
            
            const dragDropArea = document.createElement('div');
            dragDropArea.className = 'drag-drop-area';
            
            const dragSource = document.createElement('div');
            dragSource.className = 'drag-source';

            challenge.domElements = {};
            challenge.categories.forEach(category => {
                const dropTarget = document.createElement('div');
                dropTarget.className = 'drop-target';
                dropTarget.dataset.category = category;
                dropTarget.innerHTML = `<h3>${category}</h3>`;
                
                // S·ª± ki·ªán cho chu·ªôt (Desktop)
                dropTarget.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (!challenge.answered) dropTarget.classList.add('drag-over');
                });
                dropTarget.addEventListener('dragleave', () => {
                    dropTarget.classList.remove('drag-over');
                });
                dropTarget.addEventListener('drop', (e) => dropItem(e, challenge, dropTarget));
                
                challenge.domElements[category] = dropTarget;
                dragDropArea.appendChild(dropTarget);
            });
            
            challenge.shuffledItems.forEach(item => {
                const dragItem = document.createElement('div');
                dragItem.className = 'drag-item';
                dragItem.textContent = item.text;
                dragItem.draggable = true; 
                dragItem.dataset.category = item.category;
                
                // S·ª± ki·ªán TOUCH (Mobile) - G√°n handler ƒë√£ ƒë·ªãnh nghƒ©a
                dragItem.addEventListener('touchstart', touchStartHandler);
                dragItem.addEventListener('touchmove', handleTouchMove);
                dragItem.addEventListener('touchend', touchEndHandler);
                
                // L∆∞u handler ƒë·ªÉ c√≥ th·ªÉ x√≥a sau khi tr·∫£ l·ªùi
                dragItem.touchStartHandler = touchStartHandler;
                dragItem.touchEndHandler = touchEndHandler;


                // S·ª± ki·ªán cho chu·ªôt (Desktop)
                dragItem.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', dragItem.textContent);
                    e.dataTransfer.effectAllowed = 'move';
                    dragItem.classList.add('dragging'); 
                });
                dragItem.addEventListener('dragend', () => {
                    dragItem.classList.remove('dragging');
                });
                
                dragSource.appendChild(dragItem);
            });

            container.appendChild(dragSource);
            container.appendChild(dragDropArea);
        }
        
        function dropItem(e, challenge, dropTarget) {
            e.preventDefault();
            dropTarget.classList.remove('drag-over');
            if (challenge.answered) return;
            
            const data = e.dataTransfer.getData('text/plain');
            const draggedItem = Array.from(document.querySelectorAll('.drag-item')).find(item => item.textContent === data && item.parentNode.classList.contains('drag-source'));
            
            if (draggedItem) {
                if (challenge.shuffledItems.some(i => i.text === draggedItem.textContent)) {
                    dropTarget.appendChild(draggedItem);
                    checkDragDropComplete(challenge);
                }
            }
        }

        function checkDragDropComplete(challenge) {
            const dragSource = document.querySelector('.drag-source');
            const remainingItems = Array.from(dragSource.children).filter(el => el.classList.contains('drag-item'));

            if (remainingItems.length === 0) {
                challenge.answered = true;
                
                let allCorrect = true; 
                
                // V√¥ hi·ªáu h√≥a t∆∞∆°ng t√°c
                document.querySelectorAll('.drag-item').forEach(item => {
                    item.draggable = false;
                    // Lo·∫°i b·ªè Touch Handlers
                    if (item.touchStartHandler) {
                        item.removeEventListener('touchstart', item.touchStartHandler);
                        item.removeEventListener('touchmove', handleTouchMove);
                        item.removeEventListener('touchend', item.touchEndHandler);
                    }
                });

                // T√î M√ÄU: √ÅP D·ª§NG M√ÄU XANH L√Å CHO T·∫§T C·∫¢ C√ÅC M·ª§C ƒê√É K√âO TH·∫¢
                challenge.categories.forEach(category => {
                    const dropTarget = challenge.domElements[category];
                    Array.from(dropTarget.children).filter(el => el.classList.contains('drag-item')).forEach(item => {
                        // Ki·ªÉm tra k·∫øt qu·∫£ th·ª±c t·∫ø (·∫®n)
                        if (item.dataset.category !== category) {
                            allCorrect = false; 
                        }
                        
                        // HI·ªÇN TH·ªä: Lu√¥n lu√¥n t√¥ m√†u Xanh L√° cho m·ª•c ƒë√£ k√©o th·∫£
                        item.classList.add('correct-answer');
                        item.classList.remove('incorrect-answer');
                    });
                });
                
                questions[currentChallengeIndex].isCorrect = allCorrect;
                
                if (allCorrect) {
                     correctChallenges++;
                     playSound('correct'); 
                } else {
                     playSound('correct'); // D√πng √¢m thanh "ƒë√∫ng" ngay c·∫£ khi sai ƒë·ªÉ khuy·∫øn kh√≠ch
                }
                
                // V√¥ hi·ªáu h√≥a Drop Targets (Lo·∫°i b·ªè listener chu·ªôt)
                document.querySelectorAll('.drop-target').forEach(target => {
                    target.removeEventListener('dragover', (e) => {});
                    target.removeEventListener('dragleave', () => {});
                    target.removeEventListener('drop', (e) => {});
                });
                
                document.getElementById('next-button').classList.remove('hidden');
            }
        }


        // --- Chuy·ªÉn sang th·ª≠ th√°ch ti·∫øp theo ---

        function nextChallenge() {
            currentChallengeIndex++;
            loadChallenge();
        }

        // === Ph·∫ßn 3: K·∫øt qu·∫£ v√† L∆∞u tr·ªØ ===

        function finishGame() {
            const endTime = Date.now();
            const totalTime = endTime - startTime;
            
            document.getElementById('game-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');

            const totalChallenges = questions.length;
            const percentageValue = (correctChallenges / totalChallenges) * 100;
            const percentage = percentageValue.toFixed(0) + '%';
            
            let reviewText;
            let reviewClass;

            if (percentageValue === 100) {
                reviewText = "Tuy·ªát v·ªùi! Em ch√≠nh l√† m·ªôt nh√† s√°ng ch·∫ø t√≠ hon ƒë·∫ßy t√†i nƒÉng v√† ki√™n tr√¨! üíØ";
                reviewClass = 'review-excellent';
            } else if (percentageValue >= 70) {
                reviewText = "Em l√†m r·∫•t t·ªët! Em ƒë√£ n·∫Øm v·ªØng vai tr√≤, ph·∫©m ch·∫•t v√† l·ªãch s·ª≠ s√°ng ch·∫ø. üëç";
                reviewClass = 'review-good';
            } else {
                reviewText = "Em c·∫ßn √¥n t·∫≠p kƒ© h∆°n v·ªÅ vai tr√≤, ph·∫©m ch·∫•t v√† c√°c s√°ng ch·∫ø ti√™u bi·ªÉu. üí™";
                reviewClass = 'review-need-review';
            }

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            document.getElementById('res-name').textContent = playerInfo.name;
            document.getElementById('res-class').textContent = playerInfo.class;
            document.getElementById('res-play-count').textContent = playerInfo.playCount;
            document.getElementById('res-total-challenges').textContent = totalChallenges;
            document.getElementById('res-correct-challenges').textContent = correctChallenges;
            document.getElementById('res-percentage').textContent = percentage;
            document.getElementById('res-time').textContent = formatTime(totalTime);
            document.getElementById('review-text').textContent = reviewText;
            document.getElementById('review-text').className = 'review-text ' + reviewClass;
            
            document.getElementById('correct-count-display').textContent = correctChallenges; // C·∫≠p nh·∫≠t l·∫°i ƒëi·ªÉm cu·ªëi c√πng
            playSound('complete');
        }

        function shareResult() {
            const resultSection = document.getElementById('result-section');
            html2canvas(resultSection, {
                scale: 2, 
                backgroundColor: null 
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `KetQua_NhaSangCheTiHon_${playerInfo.name}_${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(error => {
                console.error("L·ªói khi ch·ª•p ·∫£nh: ", error);
                alert("ƒê√£ x·∫£y ra l·ªói khi t·∫°o ·∫£nh k·∫øt qu·∫£.");
            });
        }
    </script>

</body>
</html>